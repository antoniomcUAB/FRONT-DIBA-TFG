
<section>
  <div class="row">
    <div class="col-12 mb-3">
      <h2 class="text-center mb-4">{{ "OBS.resum" | translate }}{{date | date:'dd/MM/yyyy'}}</h2>
      <button type="button" class="float-right btn btn-outline-primary no-print" (click)="onPrint();"><i class="fa fa-file-pdf-o"></i> {{ "RESUMEN.pdf" | translate }}</button>
    </div>
  </div>
  <div class="row m-3" >
    <ng-container>
      <div class="col-12">
        <div class="card ">
          <div class="card-header text-white font-weight-bold bg-grey-400">
            RESUM VALORACIO
          </div>
          <div class="card-body bg-grey-200">
            <div class="row">
              <div class="col-9">
                <table class="table table-bordered">
                  <thead class="table-active bg-info">
                  <tr>
                    <ng-template ngFor [ngForOf]="evaluations" let-evaluacio>
                      <ng-template [ngIf]="evaluacio && evaluacio?.ambit?.ambit?.descripcio.toUpperCase() !== 'GLOBALITAT DEL CAS'">
                        <th class="border-dark border-top border-right border-left border-bottom-0" colspan="2" [ngClass]="{'bg-warning text-black-50' : evaluacio?.ambit?.ambit?.descripcio?.toUpperCase() === 'AUTONOMIA',
                         'bg-danger' : evaluacio.ambit?.ambit?.descripcio.toUpperCase() === 'MATERIAL I INSTRUMENTAL',
                         'bg-success' : evaluacio.ambit?.ambit?.descripcio.toUpperCase() === 'RELACIONAL',
                         'bg-info' : evaluacio.ambit?.ambit?.descripcio.toUpperCase() === 'GLOBALITAT DEL CAS'}">
                          {{evaluacio?.ambit?.ambit?.descripcio}}</th>
                      </ng-template>
                    </ng-template>
                  </tr>
                  </thead>
                  <tbody >
                  <ng-container>
                    <tr>
                      <ng-template ngFor [ngForOf]="evaluations" let-Riscos>
                        <ng-template [ngIf]="Riscos && Riscos?.ambit?.ambit?.descripcio.toUpperCase() !== 'GLOBALITAT DEL CAS'">
                          <th class="bg-grey-200 border-dark  border-left border-bottom border-right-0 border-top-0">RISC</th>
                          <th class="border-dark border-right border-bottom border-top-0 border-left-0 " [ngClass]="{'warning' : Riscos.risc?.descripcio.toUpperCase() === 'RISC',
                                      'danger' :Riscos.risc?.descripcio.toUpperCase() === 'ALT RISC',
                                      'success' :Riscos.risc?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                      'info' : Riscos.risc?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;'}">
                            {{Riscos?.risc?.descripcio}}</th>
                        </ng-template>
                      </ng-template>
                    </tr>
                  </ng-container>
                  </tbody>
                </table>
              </div>

              <div class="col-3">
                <table class="table table-bordered">
                  <thead class="table-active bg-info">
                  <tr>
                    <ng-template ngFor [ngForOf]="evaluations" let-evaluacio>
                      <ng-template [ngIf]="evaluacio?.ambit?.ambit?.descripcio.toUpperCase() === 'GLOBALITAT DEL CAS' ">
                        <th class="border-dark border-top border-right border-left border-bottom-0" colspan="2">{{evaluacio.ambit.ambit.descripcio}}</th>
                      </ng-template>
                    </ng-template>
                  </tr>
                  </thead>
                  <tbody >
                  <ng-container>
                    <tr>
                      <ng-template ngFor [ngForOf]="evaluations" let-evaluacio>
                        <ng-template [ngIf]="evaluacio?.ambit?.ambit?.descripcio.toUpperCase() === 'GLOBALITAT DEL CAS' ">
                          <th class="bg-grey-200 border-dark  border-left border-bottom border-right-0 border-top-0" >RISC</th>
                          <th class="border-dark border-right border-bottom border-top-0 border-left-0"
                              [ngClass]="{'warning' : evaluacio.risc?.descripcio.toUpperCase() === 'RISC',
                                      'danger' : evaluacio.risc?.descripcio.toUpperCase() === 'ALT RISC',
                                      'success' : evaluacio.risc?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                      'info' : evaluacio.risc?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;' }">
                            {{evaluacio?.risc?.descripcio}}
                          </th>
                        </ng-template>
                      </ng-template>
                    </tr>
                  </ng-container>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <!-- Ambito -->

  <div class="row m-3" *ngFor="let ambit of ambits">
    <ng-container *ngIf="ambit?.ambit?.descripcio.toUpperCase() !== 'GLOBALITAT DEL CAS'">
      <div class="col-12">
        <div class="card">
          <div class="card-header text-white font-weight-bold"
               [ngClass]="{'bg-warning text-black-50' : ambit?.ambit?.descripcio.toUpperCase() === 'AUTONOMIA',
                         'bg-danger' : ambit?.ambit?.descripcio.toUpperCase() === 'MATERIAL I INSTRUMENTAL',
                         'bg-success' : ambit?.ambit?.descripcio.toUpperCase() === 'RELACIONAL',
                         'bg-info' : ambit?.ambit?.descripcio.toUpperCase() === 'GLOBALITAT DEL CAS'}">
            {{ ambit?.ambit?.descripcio.toUpperCase() }}
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-6">
                <table class="table table-bordered">
                  <thead class="table-active">
                  <th>{{ "OBS.ssocial" | translate }}</th>
                  <th class="text-center">{{ "OBS.person" | translate }}</th>
                  <th class="text-center">{{ "OBS.risc" | translate }}</th>
                  </thead>
                  <tbody *ngFor="let entorn of ambit.entorn">
                  <ng-container *ngIf="entorn.pregunta.length > 0">
                    <tr *ngFor="let pregunta of entorn.pregunta">
                      <td>{{ pregunta.situacioSocial.social }}</td>
                      <td class="text-center">{{ pregunta.persona?.tipusPersona?.descripcio }}</td>
                      <td class="text-center"
                          [ngClass]="{'warning' : pregunta.factor?.descripcio.toUpperCase() === 'RISC',
                                      'danger' : pregunta.factor?.descripcio.toUpperCase() === 'ALT RISC',
                                      'success' : pregunta.factor?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                      'info' : pregunta.factor?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;' }">
                        {{ pregunta.factor.descripcio }}</td>
                    </tr>
                  </ng-container>
                  <ng-container *ngIf="entorn.pregunta?.length == 0">
                    <!-- No hay Situación social -->
                    <tr class="text-center">
                      <td colspan="3">{{ "OBS.no-social" | translate }} {{ entorn.descripcio }}</td>
                    </tr>
                    <!--/ No hay Situación social -->
                  </ng-container>
                  </tbody>
                </table>
                <!-- Result Automatic Evaluations -->
                <table class="table table-borderless" *ngFor="let evaluacion of evaluations">
                  <ng-container *ngIf="evaluacion.ambit.id === ambit.id">
                    <tbody>
                      <!-- Result Automatic Evaluations -->
                      <tr>
                        <td class="text-right">{{ "OBS.risc-auto" | translate }}</td>
                        <td class="text-center" [ngClass]="{'warning' : evaluacion.risc?.descripcio.toUpperCase() === 'RISC',
                                                            'danger' : evaluacion.risc?.descripcio.toUpperCase() === 'ALT RISC',
                                                            'success' : evaluacion.risc?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                                            'info' : evaluacion.risc?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;' }">
                          {{evaluacion.risc.descripcio}}
                        </td>
                      </tr>
                      <!--/ Result Automatic Evaluations -->
                      <!-- Result Professsional Evaluations -->
                      <tr *ngIf="evaluacion.riscProfessional">
                        <td class="text-right">{{ "OBS.risc-pro" | translate }}</td>
                        <td class="text-center" [ngClass]="{'warning' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'RISC',
                                                            'danger' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'ALT RISC',
                                                            'success' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                                            'info' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;' }">
                          {{evaluacion.riscProfessional?.descripcio}}
                        </td>
                      </tr>
                      <!--/ Result Professsional Evaluations -->
                      <!-- Result Professsional Justification -->
                      <tr *ngIf="evaluacion.justificacio">
                        <td class="text-right">{{ "OBS.risc-pro-justify" | translate }}</td>
                        <td>
                          <textarea class="form-control" type="text" value="{{ evaluacion.justificacio }}" id="fileObservation" disabled="disabled"></textarea>
                        </td>
                      </tr>
                      <!--/ Result Professsional Justification -->
                    </tbody>
                  </ng-container>
                </table>
              </div>
              <div class="col-6">
                <table class="table table-bordered">
                  <thead class="table-active">
                  <th>{{ "OBS.factor" | translate }}</th>
                  <th class="text-center">{{ "OBS.person" | translate }}</th>
                  <th class="text-center">{{ "OBS.type" | translate }}</th>
                  </thead>
                  <tbody>
                  <ng-container *ngIf="ambit.contextualitzacio?.length > 0" >
                    <tr *ngFor="let context of ambit.contextualitzacio">
                      <td>{{ context.factor?.descripcio }}</td>
                      <td class="text-center">
                        {{ context.persona?.tipusPersona?.descripcio }}
                      </td>
                      <td class="text-center"
                          [ngClass]="{'danger' : context.factor?.gravetat.descripcio.toUpperCase() === 'RISC',
                                      'success' : context.factor?.gravetat.descripcio.toUpperCase() === 'PROTECCI&#211;' }">
                        {{ context.factor?.gravetat.descripcio }}</td>
                    </tr>
                  </ng-container>
                  <ng-container *ngIf="ambit.contextualitzacio?.length == 0">
                    <!-- No hay Factor de contextualización -->
                    <tr class="text-center">
                      <td colspan="3">{{ "OBS.no-factor" | translate }}</td>
                    </tr>
                    <!--/ No hay Factor de contextualización -->
                  </ng-container>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- Observations Ambits -->
            <div class="form-group row">
              <div class="col-12 px-3">
                <label for="fileObservationAutonomy" class="col-form-label">
                  <i class="fa fa-pencil-square-o"></i> {{ "FORM.fileObs" | translate }}
                </label>
                <textarea class="form-control" type="text" value="{{ ambit.observacions }}" id="fileObservationAutonomy" disabled="disabled"></textarea>
              </div>
            </div>
            <!--/ Observations Ambits -->
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Global -->
  <div class="row m-3" *ngFor="let global of ambits">
    <ng-container *ngIf="global?.ambit?.descripcio.toUpperCase() === 'GLOBALITAT DEL CAS'">
      <div class="col-12">
        <div class="card">
          <div class="card-header text-white font-weight-bold bg-info">
              {{ global?.ambit?.descripcio.toUpperCase() }}
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-6">
                <table class="table table-bordered">
                  <thead class="table-active">
                  <th>{{ "OBS.factor" | translate }}</th>
                  <th class="text-center">{{ "OBS.person" | translate }}</th>
                  </thead>
                  <tbody>
                  <ng-container *ngIf="global.contextualitzacio?.length > 0" >
                    <tr *ngFor="let context of global.contextualitzacio">
                      <td>{{ context.factor?.descripcio }}</td>
                      <td class="text-center"
                          [ngClass]="{'danger' : context.factor?.gravetat.descripcio.toUpperCase() === 'RISC',
                                      'success' : context.factor?.gravetat.descripcio.toUpperCase() === 'PROTECCI&#211;' }">
                        {{ context.factor?.gravetat.descripcio }}</td>
                    </tr>
                  </ng-container>
                  <ng-container *ngIf="global.contextualitzacio?.length == 0">
                    <!-- No hay Factor de contextualización -->
                    <tr class="text-center">
                      <td colspan="3">{{ "OBS.no-factor" | translate }}</td>
                    </tr>
                  </ng-container>
                  </tbody>
                </table>
              </div>
              <div class="col-6 px-3">
                <label for="fileObservationAutonomy" class="col-form-label">
                  <i class="fa fa-pencil-square-o"></i> {{ "FORM.fileObs" | translate }}
                </label>
                <textarea class="form-control" type="text" value="{{ global.observacions }}" id="fileObservationGlobal" disabled="disabled"></textarea>
              </div>
            </div>
            <div class="row">
              <!-- Result Automatic Evaluations -->
              <table class="table table-borderless" *ngFor="let evaluacion of evaluations">
                <ng-container *ngIf="evaluacion.ambit.id === global.id">
                  <tbody>
                  <!-- Result Automatic Evaluations -->
                  <tr>
                    <td class="text-right">{{ "OBS.risc-auto" | translate }}</td>
                    <td class="text-center" [ngClass]="{'warning' : evaluacion.risc?.descripcio.toUpperCase() === 'RISC',
                                                            'danger' : evaluacion.risc?.descripcio.toUpperCase() === 'ALT RISC',
                                                            'success' : evaluacion.risc?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                                            'info' : evaluacion.risc?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;' }">
                      {{evaluacion.risc.descripcio}}
                    </td>
                  </tr>
                  <!--/ Result Automatic Evaluations -->
                  <!-- Result Professsional Evaluations -->
                  <tr *ngIf="evaluacion.riscProfessional">
                    <td class="text-right">{{ "OBS.risc-pro" | translate }}</td>
                    <td class="text-center" [ngClass]="{'warning' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'RISC',
                                                            'danger' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'ALT RISC',
                                                            'success' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'VULNERABILITAT',
                                                            'info' : evaluacion.riscProfessional?.descripcio.toUpperCase() === 'SENSE VALORACI&#211;' }">
                      {{evaluacion.riscProfessional?.descripcio}}
                    </td>
                  </tr>
                  <!--/ Result Professsional Evaluations -->
                  <!-- Result Professsional Justification -->
                  <tr *ngIf="evaluacion.justificacio">
                    <td class="text-right">{{ "OBS.risc-pro-justify" | translate }}</td>
                    <td>
                      <textarea class="form-control" type="text" value="{{ evaluacion.justificacio }}" id="fileObservationGlobal" disabled="disabled"></textarea>
                    </td>
                  </tr>
                  <!--/ Result Professsional Justification -->
                  </tbody>
                </ng-container>
              </table>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <!-- Global -->

  <!-- Return to Back -->
  <div class="row m-3">
    <div class="col-12 mb-3">
      <button type="button" class="float-right btn btn-primary no-print" [routerLink]="['/home']"><i class="fa fa-chevron-left"></i> {{ "FORM.go-back" | translate }}</button>
    </div>
  </div>
  <!--/ Return to Back -->
</section>
