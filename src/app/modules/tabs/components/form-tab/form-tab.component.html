
<!-- titulo -->
<div class="form-group">
  <div class="p-3 mt-1">
    <h4 class="mt-1">{{ "TABTITLE.titleAutonomia" | translate }}
      <button type="button" class="float-right btn btn-outline-primary" (click)="open(content)"> <i class="fa fa-arrow-left" aria-hidden="true"></i> Tornar pagina anterior</button>
    </h4>
  </div>
</div>

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-unsubscribe"><span class="text-primary">ALERTA</span></h4>
  </div>
  <form>
    <div class="modal-body">
      <div class="form-group">
        <label >Es perdran els canvis no guardats <span class="text-primary"></span></label>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-outline-dark" (click)="emitBefore();modal.dismiss('Cross click')">Tornar pagina anterior</button>
        <button type="button" class="btn btn-primary" aria-label="Close" (click)="modal.dismiss('Cross click')">Cancelar</button>
      </div>
    </div>
  </form>
</ng-template>

<ng-template #valoration let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id=""><span class="text-primary">La família/unitat conviència té dificultats per:</span></h4>
  </div>

  <form>
    <div class="modal-body">
      <div class="form-group">
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>1.</b> Pagar les factures d'habitatge o serveis públics</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>2</b>. Mantenir la llar adequadament calenta.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>3</b>. Assumir despeses inesperades.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>4</b>. Menjar carn o les proteïnes de forma regular.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>5</b>. Anar de vacances.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>6</b>. Disposar de cotxe.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>7</b>. Disposar de rentadora.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>8</b>. Disposar de connexió a internet.</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description"><b>9</b>. Disposar de telèfon mòbil</span>
        </label>
      </div>
    </div>
    <div class="modal-header">
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description">  Existeix una xarxa familiar/relacional disposada a oferir suport econòmic?</span>
        </label>
        <label class="custom-control custom-checkbox">
          <input type="checkbox" class="custom-control-input">
          <span class="custom-control-label"></span>
          <span class="custom-control-description">  Les dificultats en l'àmbit econòmic són contïnuades i sense possiblitat de canvi o millora en el curt termini?</span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.dismiss('Cross click')">Guardar</button>
      <button type="button" class="btn btn-primary" aria-label="Close" (click)="modal.dismiss('Cross click')">Cancelar</button>
    </div>
  </form>
</ng-template>

<!--/ titulo -->
<form #formTab="ngForm" ngNativeValidate (ngSubmit)="emitEnd()" *ngIf="data && value">
  <div class="card-body pt-0">
    <div class="p-3 bg-grey-500">
      <h5 class="text-white">Situació social</h5>
    </div>

    <div class="form-group row bg-grey-300 m-0 mt-3 py-2 mb-0">
    <ng-template ngFor [ngForOf]="data.ambits" let-ambit>
      <ng-template ngFor [ngForOf]="ambit.entorns" let-entorn>
        <ng-template [ngIf]="(groupRelacional.social && entorn.descripcio === 'Entorn Social' )
      || (groupRelacional.family && entorn.descripcio === 'Entorn Familiar')
      || (groupRelacional.school && entorn.descripcio === 'Entorn Escolar')
      ||(groupMaterial.house && entorn.descripcio === 'Entorn habitatge' )
      || (groupMaterial.economic && entorn.descripcio === 'Entorn Económic')
      || (groupMaterial.work && entorn.descripcio === 'Entorn Laboral')
       || (entorn.descripcio==='Autonomia' && !groupRelacional.school && !groupRelacional.family
      && !groupRelacional.social && !groupMaterial.economic && !groupMaterial.work && !groupMaterial.house) ">
          <ng-template ngFor [ngForOf]="entorn.preguntes" let-pregunta let-i="index">
            <div class="form-group row col-12 py-2">
              <!-- Situacion social Basica -->
              <div class="col-5">
                <label class="col-12" for="ssb" >{{ "TABLE.basicSocialSituation" | translate }} <i class= "fa fa-question-circle" aria-hidden="true" [ngbPopover]="pregunta.definicio" placement="right" triggers="mouseenter:mouseleave" [popoverTitle]="pregunta.definicio"></i></label>
                <input  *ngIf="!pregunta.social.includes('Ingressos insuficients (E.2)')" type="text" class="form-control " [value]= "pregunta.social " disabled  >
                <!-- situacio social De Ingressos insuficients-->
                <div *ngIf="pregunta.social.includes('Ingressos insuficients (E.2)')" class="form-group row col-12">
                  <input  type="text" class="form-control col-9 "[value]= "pregunta.social " disabled >
                  <button type="button" class=" col-3 btn btn-outline-primary" (click)="open(valoration)" ><i class="fa fa-search-plus" aria-hidden="true"></i> Valoracio </button>
                </div>
                <!--/ situacio social De Ingressos insuficients-->
              </div>
              <!--/ Situacion social Basica -->

              <!-- Aplicatiu -->
              <div class="col-1">
                <div class="col-12">
                  <div class="form-group align-items-center col-12 text-center">
                    <label > {{ "TABLE.apl" | translate }}</label>
                    <label class="custom-control custom-checkbox p-0 pl-2 apply">
                      <input type="checkbox"
                             class="custom-control-input position-relative"
                             [ngModel]="getFirstPregunta(pregunta.id , ambit, entorn)"
                             (click)=" newPregunta(pregunta.social , pregunta.id , ambit, entorn);"
                             name="aplica{{i}}">
                      <span class="custom-control-label"></span>
                      <span class="custom-control-description"></span>
                    </label>
                  </div>
                </div>
              </div>
              <!--/ Aplicatiu -->

              <!-- Persones -->
              <div class="col-2">
                <div class="col-12">
                  <label for="t1person" >{{ "TABLE.person" | translate }} </label>
                  <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                      <!--<div *ngIf="getFirstPregunta(pregunta.id , ambit, entorn)" class="input-group-text " (click)="addPregunta(pregunta.social,pregunta.id) ">-->
                      <!--<i class="fa fa-user-plus " > </i>-->
                      <!--</div>-->
                    </div>
                    <select class="form-control" id="t2person"
                            [value]="cleanSelects"
                            [disabled]="!getFirstPregunta(pregunta.id , ambit, entorn) "
                            [ngModel]="getFirstPregunta(pregunta.id , ambit, entorn)?.persona?.tipusPersona?.descripcio"
                            (ngModelChange)="changePersona(getFirstPregunta(pregunta.id , ambit, entorn), $event)"
                            name="persona{{i}}">
                      <option disabled selected value ></option>
                      <option *ngFor="let person of personsSelector"> {{person.tipusPersona.descripcio}}</option>
                    </select>
                  </div>
                </div>
              </div>
              <!--/ Persones -->

              <!-- Severity -->
              <ng-template #popContentSeverity></ng-template>
              <div class="col-1">
                <div class="col-12">
                  <label for="t1severity" >{{ "TABLE.severity" | translate }} <i class="fa fa-question-circle"
                                                                                 aria-hidden="true" [ngbPopover]=popContentSeverity
                                                                                 placement="right"
                                                                                 triggers="mouseenter:mouseleave" [popoverTitle]=" 'TABLE.severity' | translate  "></i></label>
                  <select class="form-control" id="t2severity"
                          [required]="getFirstPregunta(pregunta.id , ambit, entorn)"
                          [value]="cleanSelects"
                          [disabled]="!getFirstPregunta(pregunta.id , ambit, entorn)"
                          [ngModel]="getFirstPregunta(pregunta.id , ambit, entorn)?.gravetat?.descripcio"
                          (ngModelChange)="getValueGravetat(getFirstPregunta(pregunta.id , ambit, entorn), ambit , entorn , $event)"
                          name="severitySelected{{pregunta.id}}">
                    <option disabled selected value></option>
                    <option *ngFor="let option of pregunta.selectors "> {{option.gravetat.descripcio}}  </option>
                  </select>
                </div>
              </div>
              <!--/ Severity -->
              <!-- Frequencia -->
              <ng-template #popContentFrequency></ng-template>
              <div class="col-1">
                <div class="col-12">
                  <label for="t1frequency" >{{ "TABLE.frequency" | translate }} <i class="fa fa-question-circle"
                                                                                   aria-hidden="true"
                                                                                   [ngbPopover]=popContentFrequency
                                                                                   placement="right"
                                                                                   triggers="mouseenter:mouseleave"
                                                                                   [popoverTitle]=" 'TABLE.severity' | translate  "></i></label>
                  <select class="form-control" id="t2frequency" [required]="getFirstPregunta(pregunta.id,ambit, entorn)"
                          [value]="cleanSelects"
                          [disabled]="!getFirstPregunta(pregunta.id,ambit, entorn)"
                          [ngModel]="getFirstPregunta(pregunta.id,ambit, entorn)?.frequencia?.descripcio"
                          (ngModelChange)="getFirstPregunta(pregunta.id,ambit, entorn).frequencia.descripcio = $event"
                          name="frequencySelected{{pregunta.id}}"
                          (change)="getValueFrequencia(getFirstPregunta(pregunta.id,ambit, entorn),pregunta.id) ">
                    <option disabled selected value></option>
                    <option  *ngFor="let frequencia of getFrequencia(getFirstPregunta(pregunta.id,ambit, entorn)?.gravetat?.descripcio,pregunta.selectors)" > {{frequencia.frequencia.descripcio}}  </option>
                  </select>
                </div>
              </div>
              <!--/ Frequencia -->
              <!-- riskFactors -->
              <div class="col-2">
                <label for="t1riskFactor" >{{ "TABLE.riskFactors" | translate }}</label>
                <input type="text"
                       [ngClass]="{'warning' : getFirstPregunta(pregunta.id,ambit, entorn)?.factor?.descripcio?.toUpperCase() === 'RISC',
                                   'danger' : getFirstPregunta(pregunta.id,ambit, entorn)?.factor?.descripcio?.toUpperCase() === 'ALT RISC',
                                   'success' : getFirstPregunta(pregunta.id,ambit, entorn)?.factor?.descripcio?.toUpperCase() === 'VULNERABILITAT',
                                   'info' : getFirstPregunta(pregunta.id,ambit, entorn)?.factor?.descripcio?.toUpperCase() === 'SENSE VALORACIÓ' }"
                       class="form-control text-center" id="t1riskFactor"
                       disabled
                       [value]="getFirstPregunta(pregunta.id,ambit, entorn)?.factor?.descripcio">
              </div>
            </div>
               <!--&lt;!&ndash;Bucle for para cada fila  &ndash;&gt;-->
              <!--<ng-container *ngFor="let method of getPreguntas(pregunta.id , ambit, entorn)  ; let x = index">-->
                <!--<ng-container *ngIf="method.situacioSocial.id === pregunta.id && x!= 0 ">-->
                  <!--&lt;!&ndash; Situacio Social&ndash;&gt;-->
                  <!--<div class="form-group col-4">-->
                  <!--</div>-->
                  <!--&lt;!&ndash;/ Situacio Social&ndash;&gt;-->

                  <!--&lt;!&ndash;Aplicatiu &ndash;&gt;-->
                  <!--<div class="col-xs-1">-->
                    <!--<div class="col-12">-->
                      <!--<div class="form-group align-items-center col-12 ">-->
                        <!--<label class="custom-control custom-checkbox position-relative">-->

                        <!--</label>-->
                      <!--</div>-->
                    <!--</div>-->
                  <!--</div>-->
                  <!--&lt;!&ndash;/ Aplicatiu &ndash;&gt;-->

                  <!--&lt;!&ndash; Persones &ndash;&gt;-->
                  <!--<div class="col-2">-->
                  <!--<div class="col-12">-->

                    <!--<div class="input-group mb-2 mr-sm-2">-->
                      <!--<select class="form-control"-->
                              <!--[value]="cleanSelects"-->
                              <!--[disabled]="!getPreguntas(method.id , ambit , entorn)"-->
                              <!--[ngModel]="getPreguntas(method.id, ambit , entorn)?.persona?.tipusPersona?.descripcio"-->
                              <!--(ngModelChange)="setPersona(method.situacioSocial.id,$event)"-->
                              <!--name="persona{{i}}{{x}}">-->
                        <!--<option disabled selected value ></option>-->
                        <!--<option *ngFor="let person of personsSelector"> {{person.tipusPersona.descripcio}}</option>-->
                      <!--</select>-->
                    <!--</div>-->

                  <!--</div>-->
            <!--</div>-->

                  <!--&lt;!&ndash;/ Persones &ndash;&gt;-->

                  <!--&lt;!&ndash; Severity &ndash;&gt;-->


                  <!--<ng-template #popContentSeverity></ng-template>-->
                  <!--<div class="col-xs-2">-->
                    <!--<div class="col-12">-->
                      <!--<select class="form-control" id="severity{{x}}{{i}}"-->
                              <!--[required]="getPreguntas(method.id)"-->
                              <!--[value]="cleanSelects"-->
                              <!--[disabled]="!getPreguntas(method.id)"-->
                              <!--[ngModel]="getPreguntas(method.situacioSocial.id)?.gravetat?.descripcio"-->
                              <!--(ngModelChange)="getPreguntas(method.situacioSocial.id).gravetat.descripcio = $event;"-->
                              <!--name="severitySelected{{i}}{{x}}"-->
                              <!--(change)="getValueGravetat(getPreguntas(method.situacioSocial.id)?.gravetat,pregunta.id)">-->
                        <!--<option disabled selected value></option>-->
                        <!--<option *ngFor="let option of pregunta.selectors "> {{option.gravetat.descripcio}}  </option>-->
                      <!--</select>-->
                    <!--</div>-->
                  <!--</div>-->
                  <!--&lt;!&ndash;/ Severity &ndash;&gt;-->
                  <!--&lt;!&ndash; Frequencia &ndash;&gt;-->
                  <!--<div class="col-2">-->
                    <!--<div class="col-12">-->

                      <!--<select class="form-control" id="t1frequency"-->
                              <!--[required]="pregunta.apl"-->
                              <!--[value]="cleanSelects" [disabled]="">-->
                        <!--<ng-container *ngFor="let gravedades of pregunta.selectors">-->
                          <!--<option disabled selected value></option>-->
                          <!--<option *ngFor="let frequencia of gravedades.frequencia"> {{frequencia.frequencia.descripcio}}  </option>-->
                        <!--</ng-container>-->
                      <!--</select>-->
                    <!--</div>-->
                  <!--</div>-->
                  <!--&lt;!&ndash;/ Frequencia &ndash;&gt;-->
                  <!--&lt;!&ndash; riskFactors &ndash;&gt;-->
                  <!--<div class="form-group col-2">-->
                    <!--<input type="text" class="form-control" id="t5riskFactor"   disabled>-->
                  <!--</div>-->
                <!--</ng-container>-->
              <!--</ng-container>-->
          </ng-template>
        </ng-template>
      </ng-template>
    </ng-template>
    </div>
    <div class="p-3 bg-grey-500 mt-3">
      <h5 class="text-white">Contextualització</h5>
    </div>

    <div class="form-group row bg-grey-300 m-0 mt-3 py-2 mb-0">
      <ng-template ngFor [ngForOf]="data.ambits" let-ambit>
      <ng-template ngFor [ngForOf]="ambit.factors_context" let-cont let-c="index">
          <ng-template [ngIf]="cont.ambit.descripcio === contextualitzacio">

            <div class="form-group row col-12 py-2">
            <!-- Situacion social Basica -->
            <div class="col-5">
              <label for="ssb">{{ "TABLE.contextFactor" | translate }}</label>
              <input type="text" class="form-control" id="ssb" value="{{cont.descripcio}}" disabled>
            </div>
            <!--/ Situacion social Basica -->

            <!-- Aplica 1 persona-->
            <div class="col-1">
              <div class="col-12">
                <div class="form-group align-items-center col-12 text-center">
                  <label style="font-size: x-small"> {{ "TABLE.aplUna" | translate }}</label>
                  <label class="custom-control custom-checkbox apply">
                    <input type="checkbox" class="custom-control-input position-relative"
                            [disabled]="getFirtsContexto(cont.id , ambit , cont )?.mesUc"
                           [ngModel]="getFirtsContexto(cont.id , ambit , cont )?.membreUnic"
                           (click)="newPreguntaContext(ambit , cont, 'unic')"
                           name="aplicaContextUn{{c}}">
                    <span class="custom-control-label"></span>
                    <span class="custom-control-description"></span>
                  </label>
                </div>
              </div>
            </div>
            <!--/ Aplica 1 persona-->

            <!-- Persones -->
            <div class="col-2">
              <div class="col-12">
                <label for="t1person">{{ "TABLE.person" | translate }} </label>
                <select class="form-control" id="t1person" name="personas{{c}}"
                        [value]="cleanSelects"
                        [disabled]="!getFirtsContexto(cont.id , ambit , cont )?.membreUnic || getFirtsContexto(cont.id , ambit , cont )?.mesUc"
                        [ngModel]="getFirtsContexto(cont.id , ambit , cont )?.persona?.tipusPersona?.descripcio"
                        (ngModelChange)="changePersonaSelector(getFirtsContexto(cont.id , ambit , cont ), $event)">

                  <option disabled selected value></option>
                  <option *ngFor="let person of personsSelector"> {{person.tipusPersona.descripcio}}</option>
                </select>
              </div>
            </div>

            <!--/ Persones -->
            <!--aplica mes de una persona-->

            <div class="col-2">
              <div class="col-12">
                <div class="form-group align-items-center col-12 text-center">
                  <label style="font-size: x-small">  {{ "TABLE.aplMas" | translate }}</label>
                  <label class="custom-control custom-checkbox apply">
                    <input type="checkbox" class="custom-control-input position-relative" name="aplicaContextMesUn{{c}}"
                           [disabled]="getFirtsContexto(cont.id , ambit , cont )?.membreUnic"
                           [ngModel]="getFirtsContexto(cont.id , ambit , cont )?.mesUc"
                           (click)="newPreguntaContext(ambit , cont, 'mes')">
                    <span class="custom-control-label"></span>
                    <span class="custom-control-description"></span>
                  </label>
                </div>
              </div>
            </div>
            <!--/ aplica mes de una persona-->
            <!-- Severity -->


            <div class="col-2">
              <div class="col-12">
                  <label for="t1riskFactor" >{{ "TABLE.types" | translate }}</label>
                  <input type="text" class="form-control text-center" id="t1riskFactor"  disabled name="risc{{c}}"
                  [ngModel]="getFirtsContexto(cont.id , ambit , cont )?.factor?.gravetat?.descripcio">

              </div>
            </div>
            <!--/ Severity -->
            <!--/ FACTOR DE CONTEXTUALITZACIO -->
            <!--/  riskFactors -->
            </div>
          </ng-template>
        </ng-template>
      </ng-template>
    </div>
  </div>
  <div class="form-group row">
    <div class="form-group col-6 float-left">
      <button type="button" class="btn btn-danger ml-3 mb-1" (click)="clean();"><i class="fa fa-times" aria-hidden="true"></i> Netejar </button>
    </div>
    <div class="form-group col-6 float-right text-right">
      <button  type="submit"  class="mr-3 mb-1 btn btn-outline-success" ><i class="fa fa-arrow-right" aria-hidden="true"></i> Seguent </button>
    </div>

  </div>

</form>


